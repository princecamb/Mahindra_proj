sap.ui.define(["sap/m/MessageToast","sap/m/Dialog","sap/m/Button","sap/m/Text","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/core/BusyIndicator"],function(e,t,n,s,o,i,a){"use strict";return{SendQuotation:async function(o){debugger;a.show(0);let i=[];var r="",u="";var c=true;const l=this._view;const g=l.getContent()[0];const d=g.getAggregation("footer");var m=this._view.byId("sales::PurchaseEnquiryObjectPage--fe::CustomSubSection::Comments--_IDGenTextArea");var f="";const h=/^[^a-zA-Z0-9]+$/;const p=l.getContent()[0].mAggregations.sections[5].mForwardedAggregations.subSections[0].mAggregations._grid.mAggregations.content[0].mAggregations.content.mAggregations.items[1];let w=o.oBinding.oElementContext;var b=w.getObject();const y=o.oModel.sServiceUrl;b.baseUrl=y;const x=y+o.sPath.slice(1)+"/enquiryToVehicle";const C=await M(x);let v=true;C.value.forEach(e=>{if(!e.plant){v=false}});if(!v)i.push("Plant is Missing in Quotation Details");if(!b.commentsText){c=false;i.push("Comment is missing")}else if(h.test(b.commentsText)){c=false;i.push("Comments cannot consist solely of special characters.")}if(!b.companyCode||!b.vendorCode||!b.purchOrg||!b.purchGroup){i.push("Inquiry Details are missing.")}const P=p.getValue();var A=o.sPath;const E=/purchaseEnquiryUuid=([a-fA-F0-9-]+)/;const B=A.match(E);const T=i.join("\n");if(T.length>0){var U=new t({title:"Error",type:"Message",state:"Error",content:new s({text:`${T}\nPlease complete all required fields.`}),beginButton:new n({text:"OK",press:function(){U.close();a.hide()}})});U.open();return}else{var q=new t({title:"Confirmation",type:"Message",content:new s({text:"Do you want to send Quotiation?\nBefore sending, Please Confirm"}),beginButton:new n({text:"Confirm",press:async function(){try{q.close();a.show(0);const n=window.location.href;const s=/purchaseEnquiryUuid=([a-f0-9\-]+)/;const i=n.match(s);let r;if(i&&i[1]){r=i[1]}else{a.hide();console.log("UUID not found");e.show("Purchase Enquiry UUID not found.");return}let u="commentsFun";let c=o.getModel().bindContext(`/${u}(...)`);c.setParameter("commentsText",P).setParameter("peUuid",r);await c.execute();debugger;let g="quotationFun";let f=o.getModel().bindContext(`/${g}(...)`);var t="send";f.setParameter("peUuid",r);f.setParameter("value",t);await f.execute();const h=f.getBoundContext();debugger;const p=h.getValue();console.log(p);e.show("Quotation  Sent Successfully!");setTimeout(function(){debugger;m.setValue("");debugger}.bind(this),800);const w=l.findAggregatedObjects(true,function(e){return e.isA("sap.m.Button")&&(e.getId().includes("Edit")||e.getId().includes("send"))});w[0].setVisible(false);w[1].setVisible(false);d.setVisible(false);a.hide()}catch(t){a.hide();e.show("Error while processing request")}}}),endButton:new n({text:"Cancel",press:function(){q.close()}})})}a.show(0);q.open();a.hide();async function M(e){debugger;return new Promise((t,n)=>{jQuery.ajax({url:e,method:"GET",dataType:"json",success:function(e){t(e)},error:function(e,t,s){n(new Error(t+": "+s))}})})}a.hide()}}});
//# sourceMappingURL=SendQuotation.js.map