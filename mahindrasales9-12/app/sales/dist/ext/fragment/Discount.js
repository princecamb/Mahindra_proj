sap.ui.define(["sap/m/MessageToast"],function(e){"use strict";return{onPress:function(e){debugger;let t;let r;const s=e.getParameter("value");const o=parseInt(s);const n=e.getSource().getBindingContext();const a=parseFloat(n.getProperty("actualPrice"));const g=parseInt(n.getProperty("taxPercentage"));const i=n.getProperty("isChecked");const c=n.getProperty("band")?.match(/\(([\d.]+)%\)/);let l=c?.[1]?parseFloat(c[1]):0;if(l>0){if(o>0&&i)l=l+o;t=a*((100-l)/100);if(o>0&&!i)t=t-o}else if(o>0&&i){t=a*((100-o)/100)}else if(o>0&&!i){t=a-o}r=t+t*(g/100);n.setProperty("discountedPrice",t.toString());n.setProperty("totalPrice",r.toString());if(i){n.setProperty("mDiscount",`${s}%`)}else if(!i){n.setProperty("mDiscount",s)}},formatter:{formatText:function(e){if(e?.includes("%")){return e.slice(0,-1)}return e}},validateDiscount:async function(e){const t=e.getSource();let r=t.getValue();if(/^0+(?=[1-9])/.test(r)||/^0+\d+/.test(r)&&!r.startsWith("0.")){r=r.replace(/^0+/,"");t.setValue(r);return}if(/[^0-9.]/.test(r)||r.match(/\./g)?.length>1||/^\d*\.\d{3,}$/.test(r)){r=r.replace(/[^0-9.]/g,"").replace(/(\..*?)\..*/g,"$1").replace(/^(\d*\.\d{2}).*/,"$1");t.setValue(r);sap.m.MessageToast.show("Please enter a valid number with up to 2 decimal places.");return}let s;let o;let n=e.getSource().getParent().getParent().getParent().getParent().getParent().getBindingContext();let a=e.getParameter("value");let g=parseFloat(a?a:"0");const i=e.getSource().getBindingContext();const c=parseFloat(i.getProperty("actualPrice"));const l=parseFloat(i.getProperty("taxPercentage"));const u=i.getProperty("isChecked");const p=i.getProperty("band")?.match(/\(([\d.]+)%\)/);let P=p?.[1]?parseFloat(p[1]):0;let d=c*(P/100);let m=i.getProperty("mDiscount");m=m.includes("%")?m.slice(0,-1):m;if(u&&g+P>=100){t.setValue(m);sap.m.MessageToast.show("The discount percentage cannot exceed 100.");return}if(!u&&g+d>=c){t.setValue(m);sap.m.MessageToast.show("Discount value cannot exceed Actual Price.");return}if(P>0){if(g>0&&u)P=P+g;s=c*((100-P)/100);if(g>0&&!u)s=s-g}else if(g>0&&u){s=c*((100-g)/100)}else if(g>0&&!u){s=c-g}else{s=c}o=s+s*(l/100);i.setProperty("discountedPrice",s.toFixed(2).toString());i.setProperty("totalPrice",o.toFixed(2).toString());let f=0;let x=0;let y=0;debugger;var F=this._view.mAggregations.content[0].mAggregations.sections[3].mAggregations._grid.mAggregations.content[1].mAggregations._grid.mAggregations.content[0].mAggregations.content.mAggregations.items;var h=e.getSource().getParent().getParent().getParent().getRows();for(const e of h){debugger;const t=e.getCells?e.getCells():e.getAggregation("content");debugger;var A=parseFloat(t[5].getText());var T=parseFloat(t[9].getText());var S=parseFloat(t[11].getText());if(A&&T&&S){f=f+T;x=x+(S-T)}}y=f+x;F[0].mAggregations.items[1].setText(f.toFixed(2).toString());F[1].mAggregations.items[1].setText(x.toFixed(2).toString());F[2].mAggregations.items[1].setText(y.toFixed(2).toString());if(a===""||a==="0"){i.setProperty("mDiscount",a)}else if(u){i.setProperty("mDiscount",`${a}%`)}else if(!u){i.setProperty("mDiscount",a)}setTimeout(()=>{},2e3)}}});
//# sourceMappingURL=Discount.js.map